<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Notes_site.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs-comment{color:#969896}.css .hljs-class,.css .hljs-id,.css .hljs-pseudo,.hljs-attribute,.hljs-regexp,.hljs-tag,.hljs-variable,.html .hljs-doctype,.ruby .hljs-constant,.xml .hljs-doctype,.xml .hljs-pi,.xml .hljs-tag .hljs-title{color:#c66}.hljs-built_in,.hljs-constant,.hljs-literal,.hljs-number,.hljs-params,.hljs-pragma,.hljs-preprocessor{color:#de935f}.css .hljs-rules .hljs-attribute,.ruby .hljs-class .hljs-title{color:#f0c674}.hljs-header,.hljs-inheritance,.hljs-string,.hljs-value,.ruby .hljs-symbol,.xml .hljs-cdata{color:#b5bd68}.css .hljs-hexcolor,.hljs-title{color:#8abeb7}.coffeescript .hljs-title,.hljs-function,.javascript .hljs-title,.perl .hljs-sub,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword{color:#81a2be}.hljs-keyword,.javascript .hljs-function{color:#b294bb}.hljs{display:block;overflow-x:auto;background:#1d1f21;color:#c5c8c6;padding:.5em;-webkit-text-size-adjust:none}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .css,.xml .hljs-cdata,.xml .javascript,.xml .vbscript{opacity:.5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:2px;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:2px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:1em}.MathJax_MenuRadioCheck.RTL{right:1em;left:auto}.MathJax_MenuLabel{padding:2px 2em 4px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #CCC;margin:4px 1px 0}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:Highlight;color:HighlightText}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="мои-заметки"><a name="мои-заметки" href="#мои-заметки"></a>Мои заметки</h1><p>Разработаем небольшое приложение для хранения заметок пользователя. Используем Asp .Net Core (Razor Pages) и Entity Framework Core.</p><h2 id="1-начало-работы"><a name="1-начало-работы" href="#1-начало-работы"></a>1 Начало работы</h2><h3 id="1.1-первая-страница"><a name="1.1-первая-страница" href="#1.1-первая-страница"></a>1.1 Первая страница</h3><p>Создайте пустой проект Asp .Net Core. Задайте при создании параметры по умолчанию.</p><p>Внедрим зависимость <code>AddRazorPages</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>var builder = WebApplication.CreateBuilder(args);
builder.Services.AddRazorPages();
var app = builder.Build();
// ...
</code></pre>"><span class="hljs-keyword">var</span> builder = WebApplication.CreateBuilder(args);
builder.Services.AddRazorPages();
<span class="hljs-keyword">var</span> app = builder.Build();
<span class="hljs-comment">// ...</span>
</code></pre><p>В конвейере обработки запросов добавим <code>UseRouting</code> и <code>MapRazorPages</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>var builder = WebApplication.CreateBuilder(args);
builder.Services.AddRazorPages();
var app = builder.Build();
app.UseRouting();
app.MapRazorPages();
app.Run();
</code></pre>"><span class="hljs-keyword">var</span> builder = WebApplication.CreateBuilder(args);
builder.Services.AddRazorPages();
<span class="hljs-keyword">var</span> app = builder.Build();
app.UseRouting();
app.MapRazorPages();
app.Run();
</code></pre><p>Создадим в проекте папку Pages. Используя контекстное меню добавим страницу Razor:<br><img src="1.png" alt=""></p><p>Выберем “страница Razor пустая” и назовем ее <code>Index.cshtml</code>:<br><img src="2.png" alt=""></p><p>Добавим в коде разметки следующие строки:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;h1&amp;gt;Мои заметки: &amp;lt;/h1&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Мои заметки: <span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
</code></pre><p>После чего запустим приложение и убедимся в работоспособности.</p><h3 id="1.2-добавление-макета"><a name="1.2-добавление-макета" href="#1.2-добавление-макета"></a>1.2 Добавление макета</h3><p>Создайте в папке Pages папку Shared. Используя меню “Создать элемент” найдите шаблон “Макет Razor” и создайте новый файл <code>_Layout.cshtml</code> <strong>внутри папки Shared</strong>:<br><img src="3.png" alt=""></p><p>Напишем следующий код разметки:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot; /&amp;gt;
    &amp;lt;title&amp;gt;Сервис заметок ЕКТС - @ViewBag.Title&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
    &amp;lt;div class=&quot;wrapper&quot;&amp;gt;
        &amp;lt;header class=&quot;main-header&quot;&amp;gt;
            &amp;lt;nav&amp;gt;
                &amp;lt;div class=&quot;nav-start&quot;&amp;gt;
                    &amp;lt;a href=&quot;#&quot;&amp;gt;Мои заметки&amp;lt;/a&amp;gt;
                    &amp;lt;a href=&quot;#&quot;&amp;gt;Добавить заметку&amp;lt;/a&amp;gt;
                &amp;lt;/div&amp;gt;
                &amp;lt;div class=&quot;nav-end&quot;&amp;gt;
                    &amp;lt;a href=&quot;#&quot;&amp;gt;Вход&amp;lt;/a&amp;gt;
                    &amp;lt;a href=&quot;#&quot;&amp;gt;Регистрация&amp;lt;/a&amp;gt;
                &amp;lt;/div&amp;gt;
            &amp;lt;/nav&amp;gt;
        &amp;lt;/header&amp;gt;
        &amp;lt;main class=&quot;main-content&quot;&amp;gt;
            @RenderBody()
        &amp;lt;/main&amp;gt;
        &amp;lt;footer class=&quot;main-footer&quot;&amp;gt;
            Сервис заметок. &amp;lt;br /&amp;gt; 
            ЕКТС - 2024
        &amp;lt;/footer&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
</code></pre>"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Сервис заметок ЕКТС - @ViewBag.Title<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"wrapper"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">header</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"main-header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">nav</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav-start"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>Мои заметки<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>Добавить заметку<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav-end"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>Вход<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>Регистрация<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">nav</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">header</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">main</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"main-content"</span>&gt;</span>
            @RenderBody()
        <span class="hljs-tag">&lt;/<span class="hljs-title">main</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"main-footer"</span>&gt;</span>
            Сервис заметок. <span class="hljs-tag">&lt;<span class="hljs-title">br</span> /&gt;</span> 
            ЕКТС - 2024
        <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre><p>Создадим в папке Pages “Запуск представления Razor”:<br><img src="4.png" alt=""></p><p>Внутри будет код:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>@{
    Layout = &quot;_Layout&quot;;
}
</code></pre>">@{
    Layout = <span class="hljs-string">"_Layout"</span>;
}
</code></pre><p>Также создадим в папке Pages “Импорт представлений Razor”:<br><img src="5.png" alt=""></p><p>Пропишем в нем импорт специальных тег-хэлперов (tag helpers):</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
</code></pre>">@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
</code></pre><p>Заменим в коде <code>Layout</code> аттрибут <code>href</code> на хэлпер <code>asp-page</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>...
&amp;lt;a asp-page=&quot;/Index&quot;&amp;gt;Мои заметки&amp;lt;/a&amp;gt;
...
</code></pre>">...
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">asp-page</span>=<span class="hljs-value">"/Index"</span>&gt;</span>Мои заметки<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
...
</code></pre><p>Запустим и убедимся, что видно макет и содержимое страницы.</p><h3 id="1.3-добавление-статических-файлов"><a name="1.3-добавление-статических-файлов" href="#1.3-добавление-статических-файлов"></a>1.3 Добавление статических файлов</h3><p>Добавим поддержку статических файлов. Сперва создадим в проекте каталог <code>wwwroot</code>. Внутри создадим каталог <code>styles</code> и в нем файл <code>main.css</code>:<br><img src="6.png" alt=""></p><p>Добавим middleware <code>UseStaticFiles</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>var builder = WebApplication.CreateBuilder(args);
builder.Services.AddRazorPages();
var app = builder.Build();
app.UseStaticFiles(); // статические файлы
app.UseRouting();
app.MapRazorPages();
app.Run();
</code></pre>"><span class="hljs-keyword">var</span> builder = WebApplication.CreateBuilder(args);
builder.Services.AddRazorPages();
<span class="hljs-keyword">var</span> app = builder.Build();
app.UseStaticFiles(); <span class="hljs-comment">// статические файлы</span>
app.UseRouting();
app.MapRazorPages();
app.Run();
</code></pre><p>В коде <code>Layout</code> добавим ссылку на таблицу стилей (внутри тега <code>head</code>):</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>...
    &amp;lt;link rel=&quot;stylesheet&quot; href=&quot;~/styles/main.css&quot; /&amp;gt;
...
</code></pre>">...
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"~/styles/main.css"</span> /&gt;</span>
...
</code></pre><p>Готово, мы подключили таблицу стилей. Вы можете проверить работоспособность, задав стиль для определенных элементов.</p><h3 id="1.4-стилизация-макета"><a name="1.4-стилизация-макета" href="#1.4-стилизация-макета"></a>1.4 Стилизация макета</h3><p>Разместите в файле <code>main.css</code> код:</p><pre class="css hljs"><code class="css" data-origin="<pre><code class=&quot;css&quot;>
/* Сбросим поля для всех элементов */
* {
    margin: 0;
    padding: 0;
}

/* 
    - зададим высоту контентной части 
    - выравняем содержимое по центру
    - зададим шрифт Segoe UI
*/
body {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    font-family: &quot;Segoe UI&quot;, Arial, sans-serif;
}

/*
    - flex-grow, чтобы содержимое .wrapper заполняло пространство насколько возможно
    - max-width для ограничения по ширине
    - содержимое wrapper пойдет &quot;стеком&quot; с вертикальной ориентацией (column)
*/
.wrapper {
    flex-grow: 1;
    max-width: 1000px;
    display: flex;
    flex-direction: column;
}

/*
    - добавим отступ от header;
    - main будет заполнять пространство, насколько возможно;
*/
.wrapper main {
    margin-top: 2em;
    flex-grow: 1;
}

/*
    - добавим поля сверху и снизу;
    - выравняем текст по правому краю;
*/
.wrapper footer {
    text-align: right;
    padding: 1em 0;
}

/*
    - выравняем элементы по основной оси (по горизонтали), используя space-between;
    - выравняем элементы по дополнительной оси (по вертикали), используя align-items: center
    - зададим минимальную высоту
*/
.main-header nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-height: 3em;
}

/*
    - зададим стили ссылкам;
*/
.main-header a:link,
.main-header a:visited {
    color: black;
    text-decoration: none;
    margin-right: 2em;
}

/*
    - зададим стиль ссылкам по наведению курсора;
*/
.main-header a:hover {
    color: firebrick;
}
</code></pre>">
<span class="hljs-comment">/* Сбросим поля для всех элементов */</span>
* <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/* 
    - зададим высоту контентной части 
    - выравняем содержимое по центру
    - зададим шрифт Segoe UI
*/</span>
<span class="hljs-tag">body</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">min-height</span>:<span class="hljs-value"> <span class="hljs-number">100vh</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">justify-content</span>:<span class="hljs-value"> center</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">font-family</span>:<span class="hljs-value"> <span class="hljs-string">"Segoe UI"</span>, Arial, sans-serif</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*
    - flex-grow, чтобы содержимое .wrapper заполняло пространство насколько возможно
    - max-width для ограничения по ширине
    - содержимое wrapper пойдет "стеком" с вертикальной ориентацией (column)
*/</span>
<span class="hljs-class">.wrapper</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">flex-grow</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">max-width</span>:<span class="hljs-value"> <span class="hljs-number">1000px</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">flex-direction</span>:<span class="hljs-value"> column</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*
    - добавим отступ от header;
    - main будет заполнять пространство, насколько возможно;
*/</span>
<span class="hljs-class">.wrapper</span> <span class="hljs-tag">main</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">margin-top</span>:<span class="hljs-value"> <span class="hljs-number">2em</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">flex-grow</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*
    - добавим поля сверху и снизу;
    - выравняем текст по правому краю;
*/</span>
<span class="hljs-class">.wrapper</span> <span class="hljs-tag">footer</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value"> right</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">1em</span> <span class="hljs-number">0</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*
    - выравняем элементы по основной оси (по горизонтали), используя space-between;
    - выравняем элементы по дополнительной оси (по вертикали), используя align-items: center
    - зададим минимальную высоту
*/</span>
<span class="hljs-class">.main-header</span> <span class="hljs-tag">nav</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">justify-content</span>:<span class="hljs-value"> space-between</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">align-items</span>:<span class="hljs-value"> center</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">min-height</span>:<span class="hljs-value"> <span class="hljs-number">3em</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*
    - зададим стили ссылкам;
*/</span>
<span class="hljs-class">.main-header</span> <span class="hljs-tag">a</span><span class="hljs-pseudo">:link</span>,
<span class="hljs-class">.main-header</span> <span class="hljs-tag">a</span><span class="hljs-pseudo">:visited</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> black</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">text-decoration</span>:<span class="hljs-value"> none</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">margin-right</span>:<span class="hljs-value"> <span class="hljs-number">2em</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*
    - зададим стиль ссылкам по наведению курсора;
*/</span>
<span class="hljs-class">.main-header</span> <span class="hljs-tag">a</span><span class="hljs-pseudo">:hover</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> firebrick</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre><h2 id="2.-создание-модели-и-подключение-базы-данных"><a name="2.-создание-модели-и-подключение-базы-данных" href="#2.-создание-модели-и-подключение-базы-данных"></a>2. Создание модели и подключение базы данных</h2><p>Установите пакеты:</p><pre><code data-origin="<pre><code>Micrososft.EntityFrameworkCore
Micrososft.EntityFrameworkCore.Tools
Micrososft.EntityFrameworkCore.SqlServer
</code></pre>">Micrososft.EntityFrameworkCore
Micrososft.EntityFrameworkCore.Tools
Micrososft.EntityFrameworkCore.SqlServer
</code></pre><p>Создайте в проекте папку <code>Models</code>. Определите классы <code>Post</code> и <code>User</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class Post
{
    public int PostId { get; set; }

    [StringLength(100)]
    public required string Title { get; set; }

    public required string Body { get; set; }

    public required DateOnly CreatedDate { get; set; }

    public string? ImageUrl { get; set; }

    public virtual User? User { get; set; }
    public int UserId { get; set; }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Post</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> PostId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [StringLength(<span class="hljs-number">100</span>)]
    <span class="hljs-keyword">public</span> required <span class="hljs-keyword">string</span> Title { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> required <span class="hljs-keyword">string</span> Body { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> required DateOnly CreatedDate { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span>? ImageUrl { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> User? User { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> UserId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class User
{
    public int UserId { get; set; }

    [StringLength(150)]
    public required string Username { get; set; }

    [StringLength(300)]
    public required string Password { get; set; }

    [StringLength(300)]
    public required string Salt { get; set; }

    public virtual ICollection&amp;lt;Post&amp;gt;? Posts { get; set; }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">User</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> UserId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [StringLength(<span class="hljs-number">150</span>)]
    <span class="hljs-keyword">public</span> required <span class="hljs-keyword">string</span> Username { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [StringLength(<span class="hljs-number">300</span>)]
    <span class="hljs-keyword">public</span> required <span class="hljs-keyword">string</span> Password { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [StringLength(<span class="hljs-number">300</span>)]
    <span class="hljs-keyword">public</span> required <span class="hljs-keyword">string</span> Salt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> ICollection&lt;Post&gt;? Posts { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre><p>Создайте класс <code>PostsContext</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>    public class PostsContext : DbContext
    {
        public PostsContext(DbContextOptions options) : base(options)
        {
        }

        public virtual DbSet&amp;lt;Post&amp;gt; Posts { get; set; }
        public virtual DbSet&amp;lt;User&amp;gt; Users { get; set; }
    }
</code></pre>">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PostsContext</span> : <span class="hljs-title">DbContext</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PostsContext</span><span class="hljs-params">(DbContextOptions options)</span> : <span class="hljs-title">base</span><span class="hljs-params">(options)</span>
        </span>{
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> DbSet&lt;Post&gt; Posts { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> DbSet&lt;User&gt; Users { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }
</code></pre><p>Добавьте в <code>appsettings.json</code> строку подключения:</p><pre class="javascript hljs"><code class="js" data-origin="<pre><code class=&quot;js&quot;>{
  &quot;Logging&quot;: {
    &quot;LogLevel&quot;: {
      &quot;Default&quot;: &quot;Information&quot;,
      &quot;Microsoft.AspNetCore&quot;: &quot;Warning&quot;
    }
  },
  &quot;AllowedHosts&quot;: &quot;*&quot;,
  &quot;ConnectionStrings&quot;: {
    &quot;local&quot;: &quot;Server = (localdb)\\MSSQLLocalDb; Database = PostsIvanovIvan; Integrated Security = true&quot;
  }
}
</code></pre>">{
  <span class="hljs-string">"Logging"</span>: {
    <span class="hljs-string">"LogLevel"</span>: {
      <span class="hljs-string">"Default"</span>: <span class="hljs-string">"Information"</span>,
      <span class="hljs-string">"Microsoft.AspNetCore"</span>: <span class="hljs-string">"Warning"</span>
    }
  },
  <span class="hljs-string">"AllowedHosts"</span>: <span class="hljs-string">"*"</span>,
  <span class="hljs-string">"ConnectionStrings"</span>: {
    <span class="hljs-string">"local"</span>: <span class="hljs-string">"Server = (localdb)\\MSSQLLocalDb; Database = PostsIvanovIvan; Integrated Security = true"</span>
  }
}
</code></pre><p>Выполните внедрение зависимости <code>PostsContext</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>builder.Services.AddDbContext&amp;lt;PostsContext&amp;gt;(opt =&amp;gt;
    opt.UseSqlServer(builder.Configuration.GetConnectionString(&quot;local&quot;))
);
</code></pre>">builder.Services.AddDbContext&lt;PostsContext&gt;(opt =&gt;
    opt.UseSqlServer(builder.Configuration.GetConnectionString(<span class="hljs-string">"local"</span>))
);
</code></pre><p>Создайте миграцию:</p><pre class="powershell hljs"><code class="powershell" data-origin="<pre><code class=&quot;powershell&quot;>Add-Migration &quot;Initital&quot;
</code></pre>">Add-Migration <span class="hljs-string">"Initital"</span>
</code></pre><p>И обновите БД:</p><pre class="powershell hljs"><code class="powershell" data-origin="<pre><code class=&quot;powershell&quot;>Update-Database
</code></pre>">Update-Database
</code></pre><p>Убедитесь, что в базе данных были созданы корректные таблицы.</p><h2 id="3.-регистрация-пользователя"><a name="3.-регистрация-пользователя" href="#3.-регистрация-пользователя"></a>3. Регистрация пользователя</h2><h3 id="3.1-сервис-для-хэширования-пароля"><a name="3.1-сервис-для-хэширования-пароля" href="#3.1-сервис-для-хэширования-пароля"></a>3.1 Сервис для хэширования пароля</h3><p>Реализуем сервис для хэширования пароля. Создадим в проекте папку Services. В ней создадим интерфейс:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public interface IPasswordService
{
    string GetHash(string password, string salt);
    bool IsValid(string checkPassword, string salt, string passwordHash);
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPasswordService</span>
{
    <span class="hljs-function"><span class="hljs-keyword">string</span> <span class="hljs-title">GetHash</span><span class="hljs-params">(<span class="hljs-keyword">string</span> password, <span class="hljs-keyword">string</span> salt)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">IsValid</span><span class="hljs-params">(<span class="hljs-keyword">string</span> checkPassword, <span class="hljs-keyword">string</span> salt, <span class="hljs-keyword">string</span> passwordHash)</span></span>;
}
</code></pre><p>Метод <code>GetHash</code> используем для получения хэширования переданного пароля.<br>Метод <code>IsValid</code> проверяет, что строка <code>passwordHash</code> является хэшем пароля <code>checkPassword</code>.</p><p>Реализуем интерфейс, используя алгоритм Sha-256 и соответствующий ему класс <code>SHA256</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class Sha256PasswordService : IPasswordService
{
    public string GetHash(string password, string salt)
    {
        byte[] data = Encoding.Default.GetBytes(password + salt);
        byte[] hash = SHA256.HashData(data);
        return Convert.ToBase64String(hash);
    }

    public bool IsValid(string checkPassword, string salt, string passwordHash)
    {
        string hash = GetHash(checkPassword, salt);
        return hash == passwordHash;
    }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Sha256PasswordService</span> : <span class="hljs-title">IPasswordService</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetHash</span><span class="hljs-params">(<span class="hljs-keyword">string</span> password, <span class="hljs-keyword">string</span> salt)</span>
    </span>{
        <span class="hljs-keyword">byte</span>[] data = Encoding.Default.GetBytes(password + salt);
        <span class="hljs-keyword">byte</span>[] hash = SHA256.HashData(data);
        <span class="hljs-keyword">return</span> Convert.ToBase64String(hash);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsValid</span><span class="hljs-params">(<span class="hljs-keyword">string</span> checkPassword, <span class="hljs-keyword">string</span> salt, <span class="hljs-keyword">string</span> passwordHash)</span>
    </span>{
        <span class="hljs-keyword">string</span> hash = GetHash(checkPassword, salt);
        <span class="hljs-keyword">return</span> hash == passwordHash;
    }
}
</code></pre><p>Внедрим сервис:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>builder.Services.AddScoped&amp;lt;IPasswordService, Sha256PasswordService&amp;gt;();
</code></pre>">builder.Services.AddScoped&lt;IPasswordService, Sha256PasswordService&gt;();
</code></pre><h3 id="3.2-сервис-для-работы-с-пользователями"><a name="3.2-сервис-для-работы-с-пользователями" href="#3.2-сервис-для-работы-с-пользователями"></a>3.2 Сервис для работы с пользователями</h3><p>Добавим сервис для регистрации и аутентификации пользователя. Создадим в папке <code>Services</code> интерфейс:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public interface IUserService
{
    void Registration(string username, string password);
    bool CheckPassword(string username, string password);
    User? GetUser(string username);
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IUserService</span>
{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Registration</span><span class="hljs-params">(<span class="hljs-keyword">string</span> username, <span class="hljs-keyword">string</span> password)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">CheckPassword</span><span class="hljs-params">(<span class="hljs-keyword">string</span> username, <span class="hljs-keyword">string</span> password)</span></span>;
    User? GetUser(<span class="hljs-keyword">string</span> username);
}
</code></pre><p>Реализуем его:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class UserService : IUserService
{
    private readonly PostsContext context;
    private readonly IPasswordService passwordService;

    public UserService(PostsContext context, IPasswordService passwordService)
    {
        this.context = context;
        this.passwordService = passwordService;
    }

    public bool CheckPassword(string username, string password)
    {
        var user = context.Users.FirstOrDefault(u =&amp;gt; u.Username == username);
        if (user is null)
        {
            return false;
        }
        return passwordService.IsValid(password, user.Salt, user.Password);
    }

    public User? GetUser(string username) =&amp;gt; 
        context.Users.FirstOrDefault(u =&amp;gt; u.Username == username);

    public void Registration(string username, string password)
    {
        string salt = DateTime.UtcNow.ToString();
        string hash = passwordService.GetHash(password, salt);
        context.Users.Add(new User
        {
            Username = username,
            Password = hash,
            Salt = salt
        });
        context.SaveChanges();
    }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> : <span class="hljs-title">IUserService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> PostsContext context;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPasswordService passwordService;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserService</span><span class="hljs-params">(PostsContext context, IPasswordService passwordService)</span>
    </span>{
        <span class="hljs-keyword">this</span>.context = context;
        <span class="hljs-keyword">this</span>.passwordService = passwordService;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CheckPassword</span><span class="hljs-params">(<span class="hljs-keyword">string</span> username, <span class="hljs-keyword">string</span> password)</span>
    </span>{
        <span class="hljs-keyword">var</span> user = context.Users.FirstOrDefault(u =&gt; u.Username == username);
        <span class="hljs-keyword">if</span> (user <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>)
        {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        <span class="hljs-keyword">return</span> passwordService.IsValid(password, user.Salt, user.Password);
    }

    <span class="hljs-keyword">public</span> User? GetUser(<span class="hljs-keyword">string</span> username) =&gt; 
        context.Users.FirstOrDefault(u =&gt; u.Username == username);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Registration</span><span class="hljs-params">(<span class="hljs-keyword">string</span> username, <span class="hljs-keyword">string</span> password)</span>
    </span>{
        <span class="hljs-keyword">string</span> salt = DateTime.UtcNow.ToString();
        <span class="hljs-keyword">string</span> hash = passwordService.GetHash(password, salt);
        context.Users.Add(<span class="hljs-keyword">new</span> User
        {
            Username = username,
            Password = hash,
            Salt = salt
        });
        context.SaveChanges();
    }
}
</code></pre><p>Внедрим в контейнер:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>builder.Services.AddScoped&amp;lt;IUserService, UserService&amp;gt;();
</code></pre>">builder.Services.AddScoped&lt;IUserService, UserService&gt;();
</code></pre><h3 id="3.3-страница-регистрации"><a name="3.3-страница-регистрации" href="#3.3-страница-регистрации"></a>3.3 Страница регистрации</h3><p>Создадим в папке Pages страницу <code>Registration</code>. В <code>_Layout</code> зададим ссылку:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;a asp-page=&quot;/Registration&quot;&amp;gt;Регистрация&amp;lt;/a&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">asp-page</span>=<span class="hljs-value">"/Registration"</span>&gt;</span>Регистрация<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
</code></pre><p>Создадим в проекте папку <code>ViewModels</code>. В ней опишем класс:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class UserViewModel
{
    [StringLength(30, ErrorMessage = &quot;Имя пользователя не может содержать более 30 символов&quot;)]
    [Required(ErrorMessage = &quot;Имя пользователя не может быть пустым&quot;)]
    [Display(Name = &quot;Имя пользователя&quot;)]
    public string Username { get; set; } = string.Empty;

    [MinLength(8, ErrorMessage = &quot;Пароль не может содержать менее 8 символов&quot;)]
    [Display(Name = &quot;Пароль&quot;)]
    public string Password { get; set; } = string.Empty;

    [Display(Name = &quot;Повторите пароль&quot;)]
    [Compare(nameof(Password), ErrorMessage = &quot;Пароли не совпадают&quot;)]
    public string RepeatPassword { get; set; } = string.Empty;
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserViewModel</span>
{
    [StringLength(<span class="hljs-number">30</span>, ErrorMessage = <span class="hljs-string">"Имя пользователя не может содержать более 30 символов"</span>)]
    [Required(ErrorMessage = <span class="hljs-string">"Имя пользователя не может быть пустым"</span>)]
    [Display(Name = <span class="hljs-string">"Имя пользователя"</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Username { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;

    [MinLength(<span class="hljs-number">8</span>, ErrorMessage = <span class="hljs-string">"Пароль не может содержать менее 8 символов"</span>)]
    [Display(Name = <span class="hljs-string">"Пароль"</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Password { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;

    [Display(Name = <span class="hljs-string">"Повторите пароль"</span>)]
    [Compare(nameof(Password), ErrorMessage = <span class="hljs-string">"Пароли не совпадают"</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> RepeatPassword { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;
}
</code></pre><p>В code-behind страницы (Registration.cshtml.cs) напишем код:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>    public class RegistrationModel : PageModel
    {
        private readonly IUserService userService;

        public UserViewModel UserViewModel { get; set; } = new();

        public RegistrationModel(IUserService userService)
        {
            this.userService = userService;
        }

        public void OnGet()
        {
            // supports GET
        }
    }
</code></pre>">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RegistrationModel</span> : <span class="hljs-title">PageModel</span>
    {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IUserService userService;

        <span class="hljs-keyword">public</span> UserViewModel UserViewModel { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span>();

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RegistrationModel</span><span class="hljs-params">(IUserService userService)</span>
        </span>{
            <span class="hljs-keyword">this</span>.userService = userService;
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span><span class="hljs-params">()</span>
        </span>{
            <span class="hljs-comment">// supports GET</span>
        }
    }
</code></pre><p>И создадим в разметке страницы форму:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;form class=&quot;user-form&quot; method=&quot;post&quot;&amp;gt;
    &amp;lt;h1&amp;gt;Регистрация&amp;lt;/h1&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;UserViewModel.Username&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;UserViewModel.Username&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
        &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;UserViewModel.Password&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;UserViewModel.Password&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;UserViewModel.RepeatPassword&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;UserViewModel.RepeatPassword&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div asp-validation-summary=&quot;All&quot;&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;button&amp;gt;Зарегистрироваться&amp;lt;/button&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/form&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"user-form"</span> <span class="hljs-attribute">method</span>=<span class="hljs-value">"post"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Регистрация<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"UserViewModel.Username"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"UserViewModel.Username"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"UserViewModel.Password"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"UserViewModel.Password"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"UserViewModel.RepeatPassword"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"UserViewModel.RepeatPassword"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">asp-validation-summary</span>=<span class="hljs-value">"All"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span>&gt;</span>Зарегистрироваться<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
</code></pre><p>Также, добавим фрагмент кода, который задаст заголовок страницы (обратите внимание на <code>&lt;title&gt;</code> внутри <code>_Layout</code>):</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>@{
    ViewBag.Title = &quot;Регистрация&quot;;
}
</code></pre>">@{
    ViewBag.Title = <span class="hljs-string">"Регистрация"</span>;
}
</code></pre><p>Добавим в файл <code>_Layout</code> строку <code>@RenderSection("links", required: false)</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>...
&amp;lt;head&amp;gt;
    &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot; /&amp;gt;
    &amp;lt;title&amp;gt;Сервис заметок ЕКТС - @ViewBag.Title&amp;lt;/title&amp;gt;
    &amp;lt;link rel=&quot;stylesheet&quot; href=&quot;~/styles/main.css&quot; /&amp;gt;
    @RenderSection(&quot;links&quot;)
&amp;lt;/head&amp;gt;
...
</code></pre>">...
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Сервис заметок ЕКТС - @ViewBag.Title<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"~/styles/main.css"</span> /&gt;</span>
    @RenderSection("links")
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
...
</code></pre><p>Теперь, на любой странице можно отрисовать содержимое на месте <code>@RenderSection("links", required: false)</code>. Так, зададим на странице регистрации (выше формы):</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>@section links {
    &amp;lt;link rel=&quot;stylesheet&quot; href=&quot;~/styles/userforms.css&quot;&amp;gt;
}
</code></pre>">@section links {
    &lt;link rel=<span class="hljs-string">"stylesheet"</span> href=<span class="hljs-string">"~/styles/userforms.css"</span>&gt;
}
</code></pre><p>Создадим в папке <code>wwwroot/styles</code> файл <code>userforms.css</code>. Определим в нем стили:</p><pre class="css hljs"><code class="css" data-origin="<pre><code class=&quot;css&quot;>.user-form {
    display: flex;
    flex-direction: column;
    max-width: 640px;
}

.user-form h1 {
    margin-bottom: 0.5em;
}

.user-form .form-control {
    display: flex;
    flex-direction: column;
    margin-bottom: 0.5em;
}

.form-control input[type=&quot;submit&quot;] {
    padding: 0.25em;
}
</code></pre>"><span class="hljs-class">.user-form</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">flex-direction</span>:<span class="hljs-value"> column</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">max-width</span>:<span class="hljs-value"> <span class="hljs-number">640px</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.user-form</span> <span class="hljs-tag">h1</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"> <span class="hljs-number">0.5em</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.user-form</span> <span class="hljs-class">.form-control</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">flex-direction</span>:<span class="hljs-value"> column</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"> <span class="hljs-number">0.5em</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.form-control</span> <span class="hljs-tag">input</span><span class="hljs-attr_selector">[type="submit"]</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">0.25em</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre><p>Опишем регистрацию пользователя:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public IActionResult OnPost(UserViewModel userViewModel)
{
    if (!ModelState.IsValid)
    {
        return Page();
    }

    var contains = userService.GetUser(userViewModel.Username);
    if (contains is not null)
    {
        ModelState.AddModelError(&quot;Username&quot;, &quot;Пользователь с таким именем уже существует&quot;);
        return Page();
    }

    try
    {
        userService.Registration(userViewModel.Username, userViewModel.Password);
        return RedirectToPage(&quot;/Index&quot;);
    }
    catch
    {
        ModelState.AddModelError(&quot;&quot;, &quot;Произошла ошибка при сохранении. Попробуйте позже или обратитесь к администратору&quot;);
        return Page();
    }
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">OnPost</span><span class="hljs-params">(UserViewModel userViewModel)</span>
</span>{
    <span class="hljs-keyword">if</span> (!ModelState.IsValid)
    {
        <span class="hljs-keyword">return</span> Page();
    }

    <span class="hljs-keyword">var</span> contains = userService.GetUser(userViewModel.Username);
    <span class="hljs-keyword">if</span> (contains <span class="hljs-keyword">is</span> not <span class="hljs-keyword">null</span>)
    {
        ModelState.AddModelError(<span class="hljs-string">"Username"</span>, <span class="hljs-string">"Пользователь с таким именем уже существует"</span>);
        <span class="hljs-keyword">return</span> Page();
    }

    <span class="hljs-keyword">try</span>
    {
        userService.Registration(userViewModel.Username, userViewModel.Password);
        <span class="hljs-keyword">return</span> RedirectToPage(<span class="hljs-string">"/Index"</span>);
    }
    <span class="hljs-keyword">catch</span>
    {
        ModelState.AddModelError(<span class="hljs-string">""</span>, <span class="hljs-string">"Произошла ошибка при сохранении. Попробуйте позже или обратитесь к администратору"</span>);
        <span class="hljs-keyword">return</span> Page();
    }
}
</code></pre><p>Запустите приложение и убедитесь в его работоспособности. Убедитесь, что базу данных добавляются значения. Убедитесь, что нельзя ввести некорректные данные, а ошибки валидации отображаются в виде списка.</p><h4 id="самостоятельно"><a name="самостоятельно" href="#самостоятельно"></a>Самостоятельно</h4><ul>
<li>добейтесь, чтобы пароль отображался звездочками (скрывался);</li><li>задайте стиль для ошибок валидации, используя <code>class</code> (самостоятельно определите селектор и задайте стиль);</li></ul><h4 id="дополнительно"><a name="дополнительно" href="#дополнительно"></a>Дополнительно</h4><p>Создайте и добавьте для пароля аннотацию <code>StrongPassword</code>. Сильный пароль должен иметь длину не менее 8 символов, содержать буквы в верхнем и нижнем регистре, цифру и спецсимвол.</p><h3 id="3.4-добавление-аутентификации"><a name="3.4-добавление-аутентификации" href="#3.4-добавление-аутентификации"></a>3.4 Добавление аутентификации</h3><p>Добавьте папку Pages страницу Login.<br>Измените ссылку в шаблоне <code>_Layout</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;a asp-page=&quot;/Login&quot;&amp;gt;Вход&amp;lt;/a&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">asp-page</span>=<span class="hljs-value">"/Login"</span>&gt;</span>Вход<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
</code></pre><p>В коде разметки зададим css-файл с помощью секции:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>@section links {
    &amp;lt;link rel=&quot;stylesheet&quot; href=&quot;~/styles/userforms.css&quot;&amp;gt;
}
</code></pre>">@section links {
    &lt;link rel=<span class="hljs-string">"stylesheet"</span> href=<span class="hljs-string">"~/styles/userforms.css"</span>&gt;
}
</code></pre><p>В разметке также добавьте заголовок первого уровня “Вход в систему”.</p><p>Теперь добавим поддержку аутентификации на основе Cookies.</p><p>Сперва выполним внедрение зависимости:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>builder
    .Services
    .AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
    .AddCookie(opt =&amp;gt;
    {
        opt.LoginPath = &quot;/Login&quot;;
        opt.Cookie.Name = &quot;NotesUser&quot;;
        opt.ExpireTimeSpan = TimeSpan.FromHours(3);
    });
</code></pre>">builder
    .Services
    .AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
    .AddCookie(opt =&gt;
    {
        opt.LoginPath = <span class="hljs-string">"/Login"</span>;
        opt.Cookie.Name = <span class="hljs-string">"NotesUser"</span>;
        opt.ExpireTimeSpan = TimeSpan.FromHours(<span class="hljs-number">3</span>);
    });
</code></pre><p>Здесь: </p><ul>
<li><code>CookieAuthenticationDefaults.AuthenticationScheme</code> - это просто строка <code>Cookies</code>;</li><li><code>LoginPath</code> - путь, по которому будет перекидывать пользователя при возникновении проблем с аутентификацией;</li><li><code>Cookie.Name</code> - название cookie (можно увидеть в браузере);</li><li><code>ExpireTimeSpan</code> - время жизни cookie.</li></ul><p>После <code>UseRouting</code> добавьте middleware <code>UseAuthentication</code> и <code>UseAuthorization</code> :</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>//..
app.UseRouting();
app.UseAuthentication();
app.UseAuthorization();
app.MapRazorPages();
//..
</code></pre>"><span class="hljs-comment">//..</span>
app.UseRouting();
app.UseAuthentication();
app.UseAuthorization();
app.MapRazorPages();
<span class="hljs-comment">//..</span>
</code></pre><p>Запустите приложение. Вас не должно пускать на главную страницу. Вместо этого вас должно перекинуть на страницу входа.</p><h3 id="3.5-вход-в-систему"><a name="3.5-вход-в-систему" href="#3.5-вход-в-систему"></a>3.5 Вход в систему</h3><p>Реализуем форму для входа в систему.</p><p>Сперва создадим в папке ViewModels класс <code>LoginViewModel</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>    public class LoginViewModel
    {
        [Required(ErrorMessage = &quot;Введите имя пользователя&quot;)]
        [Display(Name = &quot;Имя пользователя&quot;)]
        public string Username { get; set; } = string.Empty;

        [Required(ErrorMessage = &quot;Введите пароль&quot;)]
        [Display(Name = &quot;Пароль&quot;)]
        [DataType(DataType.Password)] // у input автоматически будет type=&quot;password&quot;
        public string Password { get; set; } = string.Empty;
    }
</code></pre>">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LoginViewModel</span>
    {
        [Required(ErrorMessage = <span class="hljs-string">"Введите имя пользователя"</span>)]
        [Display(Name = <span class="hljs-string">"Имя пользователя"</span>)]
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Username { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;

        [Required(ErrorMessage = <span class="hljs-string">"Введите пароль"</span>)]
        [Display(Name = <span class="hljs-string">"Пароль"</span>)]
        [DataType(DataType.Password)] <span class="hljs-comment">// у input автоматически будет type="password"</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Password { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;
    }
</code></pre><p>В коде страницы формы (code-behind) опишем следующее:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class LoginModel : PageModel
{
    private readonly IUserService userService;

    public LoginViewModel LoginViewModel { get; set; } = null!;

    public LoginModel(IUserService userService)
    {
        this.userService = userService;
    }

    public IActionResult OnGet()
    {
        return Page();
    }

    public IActionResult OnPost(LoginViewModel loginViewModel)
    {
        return Page();
    }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LoginModel</span> : <span class="hljs-title">PageModel</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IUserService userService;

    <span class="hljs-keyword">public</span> LoginViewModel LoginViewModel { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">null</span>!;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginModel</span><span class="hljs-params">(IUserService userService)</span>
    </span>{
        <span class="hljs-keyword">this</span>.userService = userService;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">OnGet</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> Page();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">OnPost</span><span class="hljs-params">(LoginViewModel loginViewModel)</span>
    </span>{
        <span class="hljs-keyword">return</span> Page();
    }
}
</code></pre><p>В коде разметки определим поля ввода:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;form class=&quot;user-form&quot; method=&quot;post&quot;&amp;gt;
    &amp;lt;h1&amp;gt;
        Вход в систему
    &amp;lt;/h1&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;LoginViewModel.Username&quot; &amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;LoginViewModel.Username&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;LoginViewModel.Password&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;LoginViewModel.Password&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div asp-validation-summary=&quot;All&quot;&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;input type=&quot;submit&quot; value=&quot;Вход в систему&quot;&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/form&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"user-form"</span> <span class="hljs-attribute">method</span>=<span class="hljs-value">"post"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>
        Вход в систему
    <span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"LoginViewModel.Username"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"LoginViewModel.Username"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"LoginViewModel.Password"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"LoginViewModel.Password"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">asp-validation-summary</span>=<span class="hljs-value">"All"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Вход в систему"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
</code></pre><p>Запустите и попробуйте ввести некорректные (пустые) значения. Убедитесь, что появляются сообщения об ошибках валидации.</p><p>Определим (в code-behind) метод для входа:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private async Task LogIn(User user)
{

}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LogIn</span><span class="hljs-params">(User user)</span>
</span>{

}
</code></pre><p>Опишем метод <code>OnPost</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public async Task&amp;lt;IActionResult&amp;gt; OnPost(LoginViewModel loginViewModel)
{
    if (!ModelState.IsValid)
    {
        return Page();
    }

    bool isValidCredentials = userService.CheckPassword(loginViewModel.Username, loginViewModel.Password);

    if (!isValidCredentials)
    {
        ModelState.AddModelError(&quot;&quot;, &quot;Неверное имя пользователя или пароль&quot;);
        return Page();
    }

    User user = userService.GetUser(loginViewModel.Username)!;
    await LogIn(user);
    return Page();
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">OnPost</span><span class="hljs-params">(LoginViewModel loginViewModel)</span>
</span>{
    <span class="hljs-keyword">if</span> (!ModelState.IsValid)
    {
        <span class="hljs-keyword">return</span> Page();
    }

    <span class="hljs-keyword">bool</span> isValidCredentials = userService.CheckPassword(loginViewModel.Username, loginViewModel.Password);

    <span class="hljs-keyword">if</span> (!isValidCredentials)
    {
        ModelState.AddModelError(<span class="hljs-string">""</span>, <span class="hljs-string">"Неверное имя пользователя или пароль"</span>);
        <span class="hljs-keyword">return</span> Page();
    }

    User user = userService.GetUser(loginViewModel.Username)!;
    <span class="hljs-keyword">await</span> LogIn(user);
    <span class="hljs-keyword">return</span> Page();
}
</code></pre><p>И метод <code>LogIn</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private async Task LogIn(User user)
{
    // набор утверждений о пользователе:
    // первый параметр - ключ, второй - значение
    List&amp;lt;Claim&amp;gt; userClaims = [
        new Claim(ClaimTypes.NameIdentifier, user.UserId.ToString()),
        new Claim(ClaimTypes.Name, user.Username),
        new Claim(ClaimTypes.Role, &quot;Client&quot;)
    ];

    // создание &quot;удостоверения&quot;
    var identity = new ClaimsIdentity(
        userClaims, // утверждения о пользователе
        CookieAuthenticationDefaults.AuthenticationScheme, // схема аутентификации (cookie)
        ClaimTypes.Name, // название ключа для имени пользователя
        ClaimTypes.Role); // название ключа для роли
    var principal = new ClaimsPrincipal(identity);

    // вход в систему (используем HttpContext)
    await HttpContext.SignInAsync(principal);
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LogIn</span><span class="hljs-params">(User user)</span>
</span>{
    <span class="hljs-comment">// набор утверждений о пользователе:</span>
    <span class="hljs-comment">// первый параметр - ключ, второй - значение</span>
    List&lt;Claim&gt; userClaims = [
        <span class="hljs-keyword">new</span> Claim(ClaimTypes.NameIdentifier, user.UserId.ToString()),
        <span class="hljs-keyword">new</span> Claim(ClaimTypes.Name, user.Username),
        <span class="hljs-keyword">new</span> Claim(ClaimTypes.Role, <span class="hljs-string">"Client"</span>)
    ];

    <span class="hljs-comment">// создание "удостоверения"</span>
    <span class="hljs-keyword">var</span> identity = <span class="hljs-keyword">new</span> ClaimsIdentity(
        userClaims, <span class="hljs-comment">// утверждения о пользователе</span>
        CookieAuthenticationDefaults.AuthenticationScheme, <span class="hljs-comment">// схема аутентификации (cookie)</span>
        ClaimTypes.Name, <span class="hljs-comment">// название ключа для имени пользователя</span>
        ClaimTypes.Role); <span class="hljs-comment">// название ключа для роли</span>
    <span class="hljs-keyword">var</span> principal = <span class="hljs-keyword">new</span> ClaimsPrincipal(identity);

    <span class="hljs-comment">// вход в систему (используем HttpContext)</span>
    <span class="hljs-keyword">await</span> HttpContext.SignInAsync(principal);
}
</code></pre><p>Запустите и проверьте работоспособность.</p><p>Убедитесь что:</p><ul>
<li>происходит вход в систему;</li><li>в браузере можно найти соответствующий cookies (см. инструменты разработчика, F12);</li><li>после удаления cookies пользователь перестает быть аутентифицированным (страница “мои заметки” становится недоступной).</li></ul><h3 id="3.6-изменения-в-макете"><a name="3.6-изменения-в-макете" href="#3.6-изменения-в-макете"></a>3.6 Изменения в макете</h3><p>Внесем изменения для корректного поведения макета <code>_Layout</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;nav&amp;gt;
    @if (User.Identity?.IsAuthenticated == true)
    {
        &amp;lt;div class=&quot;nav-start&quot;&amp;gt;
            &amp;lt;a asp-page=&quot;/Index&quot;&amp;gt;Мои заметки&amp;lt;/a&amp;gt;
            &amp;lt;a href=&quot;#&quot;&amp;gt;Добавить заметку&amp;lt;/a&amp;gt;
        &amp;lt;/div&amp;gt;
        &amp;lt;div class=&quot;nav-end&quot;&amp;gt;
            &amp;lt;a href=&quot;/Logout&quot;&amp;gt;Выход из системы&amp;lt;/a&amp;gt;
        &amp;lt;/div&amp;gt;
    }
    else
    {
        &amp;lt;div class=&quot;nav-end&quot;&amp;gt;
            &amp;lt;a asp-page=&quot;/Login&quot;&amp;gt;Вход&amp;lt;/a&amp;gt;
            &amp;lt;a asp-page=&quot;/Registration&quot;&amp;gt;Регистрация&amp;lt;/a&amp;gt;
        &amp;lt;/div&amp;gt;
    }
&amp;lt;/nav&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">nav</span>&gt;</span>
    @if (User.Identity?.IsAuthenticated == true)
    {
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav-start"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">asp-page</span>=<span class="hljs-value">"/Index"</span>&gt;</span>Мои заметки<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>Добавить заметку<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav-end"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/Logout"</span>&gt;</span>Выход из системы<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    }
    else
    {
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav-end"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">asp-page</span>=<span class="hljs-value">"/Login"</span>&gt;</span>Вход<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">asp-page</span>=<span class="hljs-value">"/Registration"</span>&gt;</span>Регистрация<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    }
<span class="hljs-tag">&lt;/<span class="hljs-title">nav</span>&gt;</span>
</code></pre><p>Добавим конечную точку для выхода из системы с помощью middleware:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>// ..
app.UseAuthorization();
app.MapGet(&quot;/Logout&quot;, async context =&amp;gt; {
    await context.SignOutAsync();
    context.Response.Redirect(&quot;/&quot;);
});
app.MapRazorPages();
// ..
</code></pre>"><span class="hljs-comment">// ..</span>
app.UseAuthorization();
app.MapGet(<span class="hljs-string">"/Logout"</span>, <span class="hljs-keyword">async</span> context =&gt; {
    <span class="hljs-keyword">await</span> context.SignOutAsync();
    context.Response.Redirect(<span class="hljs-string">"/"</span>);
});
app.MapRazorPages();
<span class="hljs-comment">// ..</span>
</code></pre><p>Запустите и убедитесь, что:</p><ul>
<li>можно выполнить выход из системы;</li><li>после выхода из системы недоступна страница <code>Index</code>;</li><li>после выхода из системы удаляются cookies.</li></ul><h3 id="3.7-доступность-страницы-входа"><a name="3.7-доступность-страницы-входа" href="#3.7-доступность-страницы-входа"></a>3.7 Доступность страницы входа</h3><p>Самостоятельно добейтесь того, чтобы при попытке аутентифицированного пользователя использовать страницу <code>Login</code> его перенаправляло на <code>Index</code>. Используйте <code>OnGet</code> в коде соответствующей страницы. Используйте свойство <code>User</code> и метод <code>RedirectToPage</code>.</p><h2 id="4-работа-с-заметками"><a name="4-работа-с-заметками" href="#4-работа-с-заметками"></a>4 Работа с заметками</h2><h3 id="4.1-добавление-заметки"><a name="4.1-добавление-заметки" href="#4.1-добавление-заметки"></a>4.1 Добавление заметки</h3><p>Создайте в папке Pages страницу <code>AddPost</code>.<br>Опишите секцию <code>links</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>@section links {
    &amp;lt;link rel=&quot;stylesheet&quot; href=&quot;~/styles/userforms.css&quot;&amp;gt;
}
</code></pre>">@section links {
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"~/styles/userforms.css"</span>&gt;</span>
}
</code></pre><p>Настройте ссылку в макете <code>_Layout</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;a asp-page=&quot;/AddPost&quot;&amp;gt;Добавить заметку&amp;lt;/a&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">asp-page</span>=<span class="hljs-value">"/AddPost"</span>&gt;</span>Добавить заметку<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
</code></pre><p>Опишем сервис для работы с заметками. Сперва определим в папке Services интерфейс:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public interface IPostsService
{
    List&amp;lt;Post&amp;gt; GetPostsByUser(int userId);
    Post? FindPost(int postId);
    void AddPost(Post post);
    void UpdatePost(int postId, Post post);
    void DeletePost(Post post);
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPostsService</span>
{
    <span class="hljs-function">List&lt;Post&gt; <span class="hljs-title">GetPostsByUser</span><span class="hljs-params">(<span class="hljs-keyword">int</span> userId)</span></span>;
    Post? FindPost(<span class="hljs-keyword">int</span> postId);
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">AddPost</span><span class="hljs-params">(Post post)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">UpdatePost</span><span class="hljs-params">(<span class="hljs-keyword">int</span> postId, Post post)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DeletePost</span><span class="hljs-params">(Post post)</span></span>;
}
</code></pre><p>И реализуем его:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class PostsService : IPostsService
{
    private readonly PostsContext context;

    public PostsService(PostsContext context)
    {
        this.context = context;
    }

    public void AddPost(Post post)
    {
        context.Entry(post).State = EntityState.Added;
        context.SaveChanges();
    }

    public void DeletePost(Post post)
    {
        context.Entry(post).State = EntityState.Deleted;
        context.SaveChanges();
    }

    public Post? FindPost(int postId)
    {
        return context.Posts.Find(postId);
    }

    public List&amp;lt;Post&amp;gt; GetPostsByUser(int userId)
    {
        return context.Posts.Where(p =&amp;gt; p.UserId == userId).ToList();
    }

    public void UpdatePost(int postId, Post post)
    {
        var toUpdate = context.Posts.Find(postId);
        if (toUpdate is null)
        {
            throw new ArgumentException(&quot;Invalid post id&quot;);
        }

        toUpdate.Title = post.Title;
        toUpdate.ImageUrl = post.ImageUrl;
        toUpdate.Body = post.Body;
        toUpdate.CreatedDate = DateOnly.FromDateTime(DateTime.Today);

        context.SaveChanges();
    }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PostsService</span> : <span class="hljs-title">IPostsService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> PostsContext context;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PostsService</span><span class="hljs-params">(PostsContext context)</span>
    </span>{
        <span class="hljs-keyword">this</span>.context = context;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AddPost</span><span class="hljs-params">(Post post)</span>
    </span>{
        context.Entry(post).State = EntityState.Added;
        context.SaveChanges();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeletePost</span><span class="hljs-params">(Post post)</span>
    </span>{
        context.Entry(post).State = EntityState.Deleted;
        context.SaveChanges();
    }

    <span class="hljs-keyword">public</span> Post? FindPost(<span class="hljs-keyword">int</span> postId)
    {
        <span class="hljs-keyword">return</span> context.Posts.Find(postId);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Post&gt; <span class="hljs-title">GetPostsByUser</span><span class="hljs-params">(<span class="hljs-keyword">int</span> userId)</span>
    </span>{
        <span class="hljs-keyword">return</span> context.Posts.Where(p =&gt; p.UserId == userId).ToList();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdatePost</span><span class="hljs-params">(<span class="hljs-keyword">int</span> postId, Post post)</span>
    </span>{
        <span class="hljs-keyword">var</span> toUpdate = context.Posts.Find(postId);
        <span class="hljs-keyword">if</span> (toUpdate <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>)
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"Invalid post id"</span>);
        }

        toUpdate.Title = post.Title;
        toUpdate.ImageUrl = post.ImageUrl;
        toUpdate.Body = post.Body;
        toUpdate.CreatedDate = DateOnly.FromDateTime(DateTime.Today);

        context.SaveChanges();
    }
}
</code></pre><p>Внедрим сервис:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>builder.Services.AddScoped&amp;lt;IPostsService, PostsService&amp;gt;();
</code></pre>">builder.Services.AddScoped&lt;IPostsService, PostsService&gt;();
</code></pre><p>Далее, добавим модель представления <code>AddPostViewModel</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class AddPostViewModel
{
    [Display(Name = &quot;Название заметки&quot;)]
    [Required(ErrorMessage = &quot;Укажите название заметки&quot;)]
    public string Title { get; set; } = string.Empty;

    [Display(Name = &quot;Текст заметки&quot;)]
    [Required(ErrorMessage = &quot;Текст не может быть пустым&quot;)]
    [DataType(DataType.MultilineText)]
    public string Body { get; set; } = string.Empty;

    [Display(Name = &quot;Изображение&quot;)]
    public IFormFile? Image { get; set; }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AddPostViewModel</span>
{
    [Display(Name = <span class="hljs-string">"Название заметки"</span>)]
    [Required(ErrorMessage = <span class="hljs-string">"Укажите название заметки"</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Title { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;

    [Display(Name = <span class="hljs-string">"Текст заметки"</span>)]
    [Required(ErrorMessage = <span class="hljs-string">"Текст не может быть пустым"</span>)]
    [DataType(DataType.MultilineText)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Body { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;

    [Display(Name = <span class="hljs-string">"Изображение"</span>)]
    <span class="hljs-keyword">public</span> IFormFile? Image { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre><p>Изменим код модели страницы <code>AddPost</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class AddPostModel : PageModel
{
    private readonly IPostsService postsService;

    public AddPostViewModel AddPostViewModel { get; set; } = null!;

    public AddPostModel(IPostsService postsService) 
    {
        this.postsService = postsService;
    }

    public IActionResult OnGet()
    {
        return Page();
    }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AddPostModel</span> : <span class="hljs-title">PageModel</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPostsService postsService;

    <span class="hljs-keyword">public</span> AddPostViewModel AddPostViewModel { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">null</span>!;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AddPostModel</span><span class="hljs-params">(IPostsService postsService)</span> 
    </span>{
        <span class="hljs-keyword">this</span>.postsService = postsService;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">OnGet</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> Page();
    }
}
</code></pre><p>И создадим форму:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;form method=&quot;post&quot; class=&quot;user-form&quot; enctype=&quot;multipart/form-data&quot;&amp;gt;
    &amp;lt;h1&amp;gt;Добавление заметки&amp;lt;/h1&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;AddPostViewModel.Title&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;AddPostViewModel.Title&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;AddPostViewModel.Body&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;AddPostViewModel.Body&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;AddPostViewModel.Image&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;AddPostViewModel.Image&quot; accept=&quot;image/*&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;input type=&quot;submit&quot; value=&quot;Добавить заметку&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/form&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">method</span>=<span class="hljs-value">"post"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"user-form"</span> <span class="hljs-attribute">enctype</span>=<span class="hljs-value">"multipart/form-data"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Добавление заметки<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"AddPostViewModel.Title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"AddPostViewModel.Title"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"AddPostViewModel.Body"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"AddPostViewModel.Body"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"AddPostViewModel.Image"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"AddPostViewModel.Image"</span> <span class="hljs-attribute">accept</span>=<span class="hljs-value">"image/*"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Добавить заметку"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
</code></pre><p>Значение <code>enctype="multipart/form-data"</code> необходимо для передачи формой файла.</p><p>В папке <code>wwwroot</code> создайте папку <code>images</code>.</p><p>Напишите код добавления заметки:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public async Task&amp;lt;IActionResult&amp;gt; OnPost(AddPostViewModel addPostViewModel) 
{
    if (!ModelState.IsValid)
    {
        return Page();
    }

    // загрузка изображения
    string? url = null;

    if (addPostViewModel.Image is not null)
    {
        string ext = Path.GetExtension(addPostViewModel.Image.FileName);
        string filename = Path.GetRandomFileName() + ext;
        string filePath = Path.Combine(@&quot;wwwroot/images&quot;, filename);
        using (FileStream file = new(filePath, FileMode.Create))
        {
            await addPostViewModel.Image.CopyToAsync(file);
        }
        url = filename;
    }

    // получение из Claims идентификатора пользователя
    int userId = int.Parse(User.FindFirstValue(ClaimTypes.NameIdentifier)!);

    // создание и добавление поста
    Post post = new Post
    {
        Body = addPostViewModel.Body,
        Title = addPostViewModel.Title,
        CreatedDate = DateOnly.FromDateTime(DateTime.Today),
        ImageUrl = url,
        UserId = userId
    };

    postsService.AddPost(post);
    return RedirectToPage(&quot;Index&quot;);
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">OnPost</span><span class="hljs-params">(AddPostViewModel addPostViewModel)</span> 
</span>{
    <span class="hljs-keyword">if</span> (!ModelState.IsValid)
    {
        <span class="hljs-keyword">return</span> Page();
    }

    <span class="hljs-comment">// загрузка изображения</span>
    <span class="hljs-keyword">string</span>? url = <span class="hljs-keyword">null</span>;

    <span class="hljs-keyword">if</span> (addPostViewModel.Image <span class="hljs-keyword">is</span> not <span class="hljs-keyword">null</span>)
    {
        <span class="hljs-keyword">string</span> ext = Path.GetExtension(addPostViewModel.Image.FileName);
        <span class="hljs-keyword">string</span> filename = Path.GetRandomFileName() + ext;
        <span class="hljs-keyword">string</span> filePath = Path.Combine(<span class="hljs-string">@"wwwroot/images"</span>, filename);
        <span class="hljs-keyword">using</span> (FileStream file = <span class="hljs-keyword">new</span>(filePath, FileMode.Create))
        {
            <span class="hljs-keyword">await</span> addPostViewModel.Image.CopyToAsync(file);
        }
        url = filename;
    }

    <span class="hljs-comment">// получение из Claims идентификатора пользователя</span>
    <span class="hljs-keyword">int</span> userId = <span class="hljs-keyword">int</span>.Parse(User.FindFirstValue(ClaimTypes.NameIdentifier)!);

    <span class="hljs-comment">// создание и добавление поста</span>
    Post post = <span class="hljs-keyword">new</span> Post
    {
        Body = addPostViewModel.Body,
        Title = addPostViewModel.Title,
        CreatedDate = DateOnly.FromDateTime(DateTime.Today),
        ImageUrl = url,
        UserId = userId
    };

    postsService.AddPost(post);
    <span class="hljs-keyword">return</span> RedirectToPage(<span class="hljs-string">"Index"</span>);
}
</code></pre><p>Запустите программу и проверьте работоспособность. Данные должны быть добавлены в БД. В папка <code>images</code> должно сохраниться изображение.</p><p><em>Самостоятельно</em> реализуйте вывод ошибок валидации. Опишите соответствующий стиль: уберите для элементов списка маркер, сделайте вывод ошибок валидации красным цветом.</p><h3 id="4.2-вывод-постов"><a name="4.2-вывод-постов" href="#4.2-вывод-постов"></a>4.2 Вывод постов</h3><p>Создадим файл <code>/wwwroot/styles/index.css</code>. Определим в <code>Index.cshtml</code> секцию:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>@section links {
    &amp;lt;link rel=&quot;stylesheet&quot; href=&quot;~/styles/index.css&quot;&amp;gt;
}
</code></pre>">@section links {
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"~/styles/index.css"</span>&gt;</span>
}
</code></pre><p>Также, добавьте в <code>wwwroot/images</code> изображение-заглушку <code>noimage.png</code>.</p><p>Сверстайте в <code>index.cshtml</code> макет для одной заметки:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;div class=&quot;post&quot;&amp;gt;
    &amp;lt;div class=&quot;post-image&quot;&amp;gt;
        &amp;lt;img src=&quot;~/images/noimage.png&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;post-content&quot;&amp;gt;
        &amp;lt;h3&amp;gt;Название заметки&amp;lt;/h3&amp;gt;
        &amp;lt;p&amp;gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&amp;lt;/p&amp;gt;
        &amp;lt;div class=&quot;post-actions&quot;&amp;gt;
            &amp;lt;a href=&quot;#&quot;&amp;gt;Изменить&amp;lt;/a&amp;gt;
            &amp;lt;a href=&quot;#&quot;&amp;gt;Удалить&amp;lt;/a&amp;gt;
        &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post-image"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"~/images/noimage.png"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post-content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span>Название заметки<span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post-actions"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>Изменить<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>Удалить<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre><p><strong>Самостоятельно</strong> опишите стили в файле <code>index.css</code>. Для этого:</p><ul>
<li>для контейнера <code>post</code> задайте <code>display: flex</code> и установите отступ от верхнего элемента в <code>1.5em</code>;</li><li>для <code>post-image</code> задайте максимальную ширину в <code>150px</code>, и отступ от элемента справа в <code>0.5em</code>;</li><li>для <code>img</code> внутри <code>post-image</code> задайте максмальную ширину равную значению родительского элемента <code>inherit</code>;</li><li>используя селектор <code>.post-content &gt; *</code> задайте для всех прямых потомков <code>post-content</code> отступ от нижнего элемента в <code>0.25em</code>;</li><li>задайте для контейнера <code>post-actions</code> отступ от верхнего элемента в <code>0.8em</code>;</li><li>уберите стиль ссылок по умолчанию, для этого с помощью селекторов <code>.post-actions a:link</code> и <code>.post-actions a:visited</code> установите свойства <code>text-decoration: none</code> и <code>color: black</code>;</li><li>для всех тегов <code>a</code> внутри <code>post-actions</code> задайте <code>padding: 0.25em 0.4em</code>, <code>border: 1px solid black</code>, <code>border-radius: 2px</code> и <code>margin-left: 0.25em</code>. Это задаст ссылками внешний вид кнопки;</li><li>чтобы сделать изменение цвета по наведению на ссылку, задайте с помощью селектора <code>.post-actions a:hover</code> свойство <code>background-color: firebrick</code>.</li></ul><p>Вы также можете немного изменить стили на свое усмотрение.</p><p>Примерный результат (только кнопки будут не справа, а слева):<br><img src="7.png" alt=""></p><p>Выведем посты из базы данных. В файле <code>index.cshtml.cs</code> в классе <code>IndexModel</code> внедрим зависимость:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private readonly IPostsService postsService;

public IndexModel(IPostsService postsService)
{
    this.postsService = postsService;
}
</code></pre>"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPostsService postsService;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">IndexModel</span><span class="hljs-params">(IPostsService postsService)</span>
</span>{
    <span class="hljs-keyword">this</span>.postsService = postsService;
}
</code></pre><p>Далее, опишем список постов:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public List&amp;lt;Post&amp;gt; Posts { get; set; } = new();
</code></pre>"><span class="hljs-keyword">public</span> List&lt;Post&gt; Posts { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span>();
</code></pre><p>Выплоним загрузку постов в <code>OnGet</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public void OnGet()
{
    int userId = Convert.ToInt32(User.FindFirst(ClaimTypes.NameIdentifier)?.Value);
    Posts = postsService.GetPostsByUser(userId);
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">int</span> userId = Convert.ToInt32(User.FindFirst(ClaimTypes.NameIdentifier)?.Value);
    Posts = postsService.GetPostsByUser(userId);
}
</code></pre><p>В коде разметки вместо вывода поста-заглушки проитерируем по постам:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>@foreach (Post post in Model.Posts)
{
    &amp;lt;div class=&quot;post&quot;&amp;gt;
        &amp;lt;div class=&quot;post-image&quot;&amp;gt;
            &amp;lt;img src=&quot;@post.ImageUrl&quot; /&amp;gt;
        &amp;lt;/div&amp;gt;
        &amp;lt;div class=&quot;post-content&quot;&amp;gt;
            &amp;lt;h3&amp;gt;@post.Title&amp;lt;/h3&amp;gt;
            &amp;lt;p&amp;gt;@post.Body&amp;lt;/p&amp;gt;
            &amp;lt;div class=&quot;post-actions&quot;&amp;gt;
                &amp;lt;a href=&quot;#&quot;&amp;gt;Изменить&amp;lt;/a&amp;gt;
                &amp;lt;a href=&quot;#&quot;&amp;gt;Удалить&amp;lt;/a&amp;gt;
            &amp;lt;/div&amp;gt;
        &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
}
</code></pre>">@foreach (Post post in Model.Posts)
{
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post-image"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"@post.ImageUrl"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post-content"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span>@post.Title<span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>@post.Body<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post-actions"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>Изменить<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>Удалить<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
}
</code></pre><p>Проверьте работоспособность.<br><strong>Самостоятельно</strong> добейтесь того, чтобы в случае отсутствия изображения выводилась заглушка <code>noimage.png</code>.</p><h3 id="4.3-изменение-поста"><a name="4.3-изменение-поста" href="#4.3-изменение-поста"></a>4.3 Изменение поста</h3><p>Создайте страницу <code>UpdatePost</code>. Добавьте секцию:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>@section links {
    &amp;lt;link rel=&quot;stylesheet&quot; href=&quot;~/styles/userforms.css&quot;&amp;gt;
}
</code></pre>">@section links {
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"~/styles/userforms.css"</span>&gt;</span>
}
</code></pre><p>Создайте модель представления:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class UpdatePostViewModel
{
    [Key]
    public int PostId { get; set; }

    [Display(Name = &quot;Название заметки&quot;)]
    [Required(ErrorMessage = &quot;Укажите название заметки&quot;)]
    public string Title { get; set; } = string.Empty;

    [Display(Name = &quot;Текст заметки&quot;)]
    [Required(ErrorMessage = &quot;Текст не может быть пустым&quot;)]
    [DataType(DataType.MultilineText)]
    public string Body { get; set; } = string.Empty;

    [Display(Name = &quot;Текущее изображение&quot;)]
    public string? CurrentImage { get; set; }

    [Display(Name = &quot;Изменить изображение&quot;)]
    public IFormFile? Image { get; set; }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UpdatePostViewModel</span>
{
    [Key]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> PostId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [Display(Name = <span class="hljs-string">"Название заметки"</span>)]
    [Required(ErrorMessage = <span class="hljs-string">"Укажите название заметки"</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Title { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;

    [Display(Name = <span class="hljs-string">"Текст заметки"</span>)]
    [Required(ErrorMessage = <span class="hljs-string">"Текст не может быть пустым"</span>)]
    [DataType(DataType.MultilineText)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Body { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;

    [Display(Name = <span class="hljs-string">"Текущее изображение"</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span>? CurrentImage { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [Display(Name = <span class="hljs-string">"Изменить изображение"</span>)]
    <span class="hljs-keyword">public</span> IFormFile? Image { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre><p>В <code>UpdatePost.cshtml.cs</code> внедрим зависимость и добавим свойство:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>// /updatepost?postId=123
public IActionResult OnGet(int postId)
{
    var post = postsService.FindPost(postId);
    if (post is null || post.UserId.ToString() != User.FindFirst(ClaimTypes.NameIdentifier)?.Value)
    {
        return NotFound();
    }
    PostViewModel.PostId = post.PostId;
    PostViewModel.Title = post.Title;
    PostViewModel.Body = post.Body;
    PostViewModel.CurrentImage = post.ImageUrl;
    return Page();
}
</code></pre>"><span class="hljs-comment">// /updatepost?postId=123</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">OnGet</span><span class="hljs-params">(<span class="hljs-keyword">int</span> postId)</span>
</span>{
    <span class="hljs-keyword">var</span> post = postsService.FindPost(postId);
    <span class="hljs-keyword">if</span> (post <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> || post.UserId.ToString() != User.FindFirst(ClaimTypes.NameIdentifier)?.Value)
    {
        <span class="hljs-keyword">return</span> NotFound();
    }
    PostViewModel.PostId = post.PostId;
    PostViewModel.Title = post.Title;
    PostViewModel.Body = post.Body;
    PostViewModel.CurrentImage = post.ImageUrl;
    <span class="hljs-keyword">return</span> Page();
}
</code></pre><p>В коде разметки напишем:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>&amp;lt;form method=&quot;post&quot; class=&quot;user-form&quot; enctype=&quot;multipart/form-data&quot;&amp;gt;
    &amp;lt;h1&amp;gt;Изменение заметки&amp;lt;/h1&amp;gt;
    &amp;lt;input type=&quot;hidden&quot; asp-for=&quot;PostViewModel.PostId&quot; /&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;PostViewModel.Title&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;PostViewModel.Title&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;PostViewModel.Body&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;textarea asp-for=&quot;PostViewModel.Body&quot;&amp;gt;
        &amp;lt;/textarea&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;PostViewModel.CurrentImage&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;PostViewModel.CurrentImage&quot; accept=&quot;image/*&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;label asp-for=&quot;PostViewModel.Image&quot;&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=&quot;PostViewModel.Image&quot; accept=&quot;image/*&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div asp-validation-summary=&quot;All&quot;&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;form-control&quot;&amp;gt;
        &amp;lt;input type=&quot;submit&quot; value=&quot;Изменить заметку&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/form&amp;gt;
</code></pre>">&lt;form method=<span class="hljs-string">"post"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"user-form"</span> enctype=<span class="hljs-string">"multipart/form-data"</span>&gt;
    &lt;h1&gt;Изменение заметки&lt;/h1&gt;
    &lt;input type=<span class="hljs-string">"hidden"</span> asp-<span class="hljs-keyword">for</span>=<span class="hljs-string">"PostViewModel.PostId"</span> /&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"form-control"</span>&gt;
        &lt;label asp-<span class="hljs-keyword">for</span>=<span class="hljs-string">"PostViewModel.Title"</span>&gt;&lt;/label&gt;
        &lt;input asp-<span class="hljs-keyword">for</span>=<span class="hljs-string">"PostViewModel.Title"</span> /&gt;
    &lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"form-control"</span>&gt;
        &lt;label asp-<span class="hljs-keyword">for</span>=<span class="hljs-string">"PostViewModel.Body"</span>&gt;&lt;/label&gt;
        &lt;textarea asp-<span class="hljs-keyword">for</span>=<span class="hljs-string">"PostViewModel.Body"</span>&gt;
        &lt;/textarea&gt;
    &lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"form-control"</span>&gt;
        &lt;label asp-<span class="hljs-keyword">for</span>=<span class="hljs-string">"PostViewModel.CurrentImage"</span>&gt;&lt;/label&gt;
        &lt;input asp-<span class="hljs-keyword">for</span>=<span class="hljs-string">"PostViewModel.CurrentImage"</span> accept=<span class="hljs-string">"image/*"</span> /&gt;
    &lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"form-control"</span>&gt;
        &lt;label asp-<span class="hljs-keyword">for</span>=<span class="hljs-string">"PostViewModel.Image"</span>&gt;&lt;/label&gt;
        &lt;input asp-<span class="hljs-keyword">for</span>=<span class="hljs-string">"PostViewModel.Image"</span> accept=<span class="hljs-string">"image/*"</span> /&gt;
    &lt;/div&gt;
    &lt;div asp-validation-summary=<span class="hljs-string">"All"</span>&gt;&lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"form-control"</span>&gt;
        &lt;input type=<span class="hljs-string">"submit"</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">"Изменить заметку"</span> /&gt;
    &lt;/div&gt;
&lt;/form&gt;
</code></pre><p>В <code>Index.cshtml</code> изменим ссылку:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;a asp-page=&quot;/UpdatePost&quot; asp-route-postId=&quot;@post.PostId&quot;&amp;gt;Изменить&amp;lt;/a&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">asp-page</span>=<span class="hljs-value">"/UpdatePost"</span> <span class="hljs-attribute">asp-route-postId</span>=<span class="hljs-value">"@post.PostId"</span>&gt;</span>Изменить<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
</code></pre><p>Запустите и проверьте возможность перехода по ссылке. Убедитесь, что все поля заполнены корректными значениями.</p><p>Реализуем вывод выбранного изображения. Сперва добавим для полей ввода идентификаторы <code>id</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>...
&amp;lt;div class=&quot;form-control&quot;&amp;gt;
    &amp;lt;label asp-for=&quot;PostViewModel.CurrentImage&quot;&amp;gt;&amp;lt;/label&amp;gt;
    &amp;lt;img id=&quot;current-image&quot; width=&quot;150&quot; src=&quot;~/images/@Model.PostViewModel.CurrentImage&quot; /&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class=&quot;form-control&quot;&amp;gt;
    &amp;lt;label asp-for=&quot;PostViewModel.Image&quot;&amp;gt;&amp;lt;/label&amp;gt;
    &amp;lt;input id=&quot;image-input&quot; asp-for=&quot;PostViewModel.Image&quot; accept=&quot;image/*&quot; /&amp;gt;
&amp;lt;/div&amp;gt;
...
</code></pre>">...
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"PostViewModel.CurrentImage"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"current-image"</span> <span class="hljs-attribute">width</span>=<span class="hljs-value">"150"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"~/images/@Model.PostViewModel.CurrentImage"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"PostViewModel.Image"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"image-input"</span> <span class="hljs-attribute">asp-for</span>=<span class="hljs-value">"PostViewModel.Image"</span> <span class="hljs-attribute">accept</span>=<span class="hljs-value">"image/*"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
...
</code></pre><p>Ниже, в <code>UpdatePage.cshtml</code> напишем скрипт:</p><pre class="javascript hljs"><code class="js" data-origin="<pre><code class=&quot;js&quot;>&amp;lt;script&amp;gt;
    let fileInput = document.getElementById('image-input');
    let fileOutput = document.getElementById('current-image');

    fileInput.onchange = input =&amp;gt; {
        fileOutput.setAttribute(&quot;src&quot;, URL.createObjectURL(fileInput.files[0]));
    };
&amp;lt;/script&amp;gt;
</code></pre>">&lt;script&gt;
    <span class="hljs-keyword">let</span> fileInput = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'image-input'</span>);
    <span class="hljs-keyword">let</span> fileOutput = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'current-image'</span>);

    fileInput.onchange = input =&gt; {
        fileOutput.setAttribute(<span class="hljs-string">"src"</span>, URL.createObjectURL(fileInput.files[<span class="hljs-number">0</span>]));
    };
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</span></code></pre><p>Проверьте работоспособность. После выбора нового изображения оно будет показано на форме.</p><p>Теперь реализуем метод изменения. Добавим в code behind страницы метод OnPost:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public async Task&amp;lt;IActionResult&amp;gt; OnPost(UpdatePostViewModel postViewModel) 
{ 
    // проверяем валидность модели
    if (!ModelState.IsValid)
    {
        return Page();
    }

    // проверяем идентификатор записи
    var post = postsService.FindPost(postViewModel.PostId);
    if (post is null)
    {
        ModelState.AddModelError(&quot;&quot;, &quot;Задан некорректный идентификатор записи&quot;);
        return Page();
    }

    // если передано изображение, то загружаем файл и заменяем путь
    if (postViewModel.Image is not null)
    {
        string ext = Path.GetExtension(postViewModel.Image.FileName);
        string filename = Path.GetRandomFileName() + ext;
        string filePath = Path.Combine(@&quot;wwwroot/images&quot;, filename);
        using (FileStream file = new(filePath, FileMode.Create))
        {
            await postViewModel.Image.CopyToAsync(file);
        }
        post.ImageUrl = filename;
    }

    // проверяем id пользователя
    int userId = int.Parse(User.FindFirstValue(ClaimTypes.NameIdentifier)!);
    if (post.UserId != userId)
    {
        return Forbid();
    }

    // заменяем значения полей и сохраняем результат в БД
    post.Title = postViewModel.Title;
    post.Body = postViewModel.Body;
    postsService.UpdatePost(post.PostId, post);
    return RedirectToPage(&quot;/Index&quot;);
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">OnPost</span><span class="hljs-params">(UpdatePostViewModel postViewModel)</span> 
</span>{ 
    <span class="hljs-comment">// проверяем валидность модели</span>
    <span class="hljs-keyword">if</span> (!ModelState.IsValid)
    {
        <span class="hljs-keyword">return</span> Page();
    }

    <span class="hljs-comment">// проверяем идентификатор записи</span>
    <span class="hljs-keyword">var</span> post = postsService.FindPost(postViewModel.PostId);
    <span class="hljs-keyword">if</span> (post <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>)
    {
        ModelState.AddModelError(<span class="hljs-string">""</span>, <span class="hljs-string">"Задан некорректный идентификатор записи"</span>);
        <span class="hljs-keyword">return</span> Page();
    }

    <span class="hljs-comment">// если передано изображение, то загружаем файл и заменяем путь</span>
    <span class="hljs-keyword">if</span> (postViewModel.Image <span class="hljs-keyword">is</span> not <span class="hljs-keyword">null</span>)
    {
        <span class="hljs-keyword">string</span> ext = Path.GetExtension(postViewModel.Image.FileName);
        <span class="hljs-keyword">string</span> filename = Path.GetRandomFileName() + ext;
        <span class="hljs-keyword">string</span> filePath = Path.Combine(<span class="hljs-string">@"wwwroot/images"</span>, filename);
        <span class="hljs-keyword">using</span> (FileStream file = <span class="hljs-keyword">new</span>(filePath, FileMode.Create))
        {
            <span class="hljs-keyword">await</span> postViewModel.Image.CopyToAsync(file);
        }
        post.ImageUrl = filename;
    }

    <span class="hljs-comment">// проверяем id пользователя</span>
    <span class="hljs-keyword">int</span> userId = <span class="hljs-keyword">int</span>.Parse(User.FindFirstValue(ClaimTypes.NameIdentifier)!);
    <span class="hljs-keyword">if</span> (post.UserId != userId)
    {
        <span class="hljs-keyword">return</span> Forbid();
    }

    <span class="hljs-comment">// заменяем значения полей и сохраняем результат в БД</span>
    post.Title = postViewModel.Title;
    post.Body = postViewModel.Body;
    postsService.UpdatePost(post.PostId, post);
    <span class="hljs-keyword">return</span> RedirectToPage(<span class="hljs-string">"/Index"</span>);
}
</code></pre><p>Запустите и проверьте рабостоспособность.</p><h3 id="4.4-удаление-заметки"><a name="4.4-удаление-заметки" href="#4.4-удаление-заметки"></a>4.4 Удаление заметки</h3><p>Реализуйте <strong>самостоятельно</strong>. При нажатии на кнопку “Удалить” пользователь переходит на отдельную страницу удаления, где будет выведена информация об удаляемой заметке (название, текст, изображение). На странице также должно быть две кнопки: “Назад”, которая переведет пользователя на <code>Index</code>; и “Удалить”, которая подтвердит удаление заметки.</p><p><em>Дополнительно:</em><br>реализуйте удаление изображения из соответствующего каталога.</p><h2 id="5-сообщения-об-обратной-связи"><a name="5-сообщения-об-обратной-связи" href="#5-сообщения-об-обратной-связи"></a>5 Сообщения об обратной связи</h2><p>Реализуем вручную сообщения об обратной связи (на практике вы можете использовать готовые библиотеки, например <code>Toastr</code>). Для этого используем сессии, код разметки и javascript.<br>Сессии позволят нам сохранить некоторые значения в специальный словарь, который будет существовать во время сессии пользователя (до закрытия браузера). Мы можем воспользоваться этим, чтобы отображать ошибки и результаты действий.</p><p>Добавим сессии в <code>Program.cs</code>.<br>Зависимости:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>builder.Services.AddSession();
builder.Services.AddSingleton&amp;lt;IHttpContextAccessor, HttpContextAccessor&amp;gt;();
</code></pre>">builder.Services.AddSession();
builder.Services.AddSingleton&lt;IHttpContextAccessor, HttpContextAccessor&gt;();
</code></pre><p>Middleware:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>...
app.UseStaticFiles();
app.UseSession(); // сессии
app.UseRouting();
...
</code></pre>">...
app.UseStaticFiles();
app.UseSession(); <span class="hljs-comment">// сессии</span>
app.UseRouting();
...
</code></pre><p>В папке <code>Sevices</code> создадим интерфейс <code>INotifyService</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public interface INotifyService
{
    void Error(string message);
    bool HasError { get; }
    string? ErrorMessage { get; }
    void Success(string message);
    bool HasSuccess { get; }
    string? SuccessMessage { get; }
    void Clear();
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">INotifyService</span>
{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error</span><span class="hljs-params">(<span class="hljs-keyword">string</span> message)</span></span>;
    <span class="hljs-keyword">bool</span> HasError { <span class="hljs-keyword">get</span>; }
    <span class="hljs-keyword">string</span>? ErrorMessage { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Success</span><span class="hljs-params">(<span class="hljs-keyword">string</span> message)</span></span>;
    <span class="hljs-keyword">bool</span> HasSuccess { <span class="hljs-keyword">get</span>; }
    <span class="hljs-keyword">string</span>? SuccessMessage { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Clear</span><span class="hljs-params">()</span></span>;
}
</code></pre><p>Реализуем интерфейс:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class SessionNotifyService : INotifyService
{
    private readonly ISession session;
    private const string successKey = &quot;success_message&quot;;
    private const string errorKey = &quot;error_message&quot;;

    public SessionNotifyService(IHttpContextAccessor httpContext)
    {
        this.session = httpContext.HttpContext.Session;
    }

    public bool HasError =&amp;gt; !string.IsNullOrEmpty(session.GetString(errorKey));

    public string? ErrorMessage =&amp;gt; session.GetString(errorKey);

    public bool HasSuccess =&amp;gt; !string.IsNullOrEmpty(session.GetString(successKey));

    public string? SuccessMessage =&amp;gt; session.GetString(successKey);

    public void Clear()
    {
        session.Remove(errorKey);
        session.Remove(successKey);
    }

    public void Error(string message)
    {
        session.SetString(errorKey, message);
    }

    public void Success(string message)
    {
        session.SetString(successKey, message);
    }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SessionNotifyService</span> : <span class="hljs-title">INotifyService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ISession session;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> successKey = <span class="hljs-string">"success_message"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> errorKey = <span class="hljs-string">"error_message"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SessionNotifyService</span><span class="hljs-params">(IHttpContextAccessor httpContext)</span>
    </span>{
        <span class="hljs-keyword">this</span>.session = httpContext.HttpContext.Session;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> HasError =&gt; !<span class="hljs-keyword">string</span>.IsNullOrEmpty(session.GetString(errorKey));

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span>? ErrorMessage =&gt; session.GetString(errorKey);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> HasSuccess =&gt; !<span class="hljs-keyword">string</span>.IsNullOrEmpty(session.GetString(successKey));

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span>? SuccessMessage =&gt; session.GetString(successKey);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Clear</span><span class="hljs-params">()</span>
    </span>{
        session.Remove(errorKey);
        session.Remove(successKey);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Error</span><span class="hljs-params">(<span class="hljs-keyword">string</span> message)</span>
    </span>{
        session.SetString(errorKey, message);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Success</span><span class="hljs-params">(<span class="hljs-keyword">string</span> message)</span>
    </span>{
        session.SetString(successKey, message);
    }
}
</code></pre><p>Добавим сервис в DI-контейнер:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>builder.Services.AddScoped&amp;lt;INotifyService, SessionNotifyService&amp;gt;();
</code></pre>">builder.Services.AddScoped&lt;INotifyService, SessionNotifyService&gt;();
</code></pre><p>В макете (<code>_layout</code>) добавим между <code>header</code> и <code>main</code> следующий элемент:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;div class=&quot;notifications&quot;&amp;gt;
    &amp;lt;div class=&quot;alert error&quot;&amp;gt;
        &amp;lt;p&amp;gt;Произошла ошибка&amp;lt;/p&amp;gt;
        &amp;lt;span class=&quot;closebtn&quot; onclick=&quot;this.parentElement.style.display='none';&quot;&amp;gt;&amp;amp;times;&amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;alert success&quot;&amp;gt;
        &amp;lt;p&amp;gt;Успех&amp;lt;/p&amp;gt;
        &amp;lt;span class=&quot;closebtn&quot; onclick=&quot;this.parentElement.style.display='none';&quot;&amp;gt;&amp;amp;times;&amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"notifications"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"alert error"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Произошла ошибка<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"closebtn"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"this.parentElement.style.display='none';"</span>&gt;</span>&amp;times;<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"alert success"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Успех<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"closebtn"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"this.parentElement.style.display='none';"</span>&gt;</span>&amp;times;<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre><p>В файле <code>main.css</code> добавьте стили:</p><pre class="css hljs"><code class="css" data-origin="<pre><code class=&quot;css&quot;>.alert {
    padding: 20px;
    display: flex;
    justify-content: space-between;
    color: white;
    margin-bottom: 15px;
    align-content: center;
    font-size: 1.25em;
}

.error {
    background: red;
}

.success {
    background: green;
}

.closebtn {
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}
</code></pre>"><span class="hljs-class">.alert</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">20px</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">justify-content</span>:<span class="hljs-value"> space-between</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> white</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"> <span class="hljs-number">15px</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">align-content</span>:<span class="hljs-value"> center</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">1.25em</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.error</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> red</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.success</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> green</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.closebtn</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> white</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">font-weight</span>:<span class="hljs-value"> bold</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">cursor</span>:<span class="hljs-value"> pointer</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">transition</span>:<span class="hljs-value"> <span class="hljs-number">0.3s</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre><p>Запустите и проверьте работоспособность. Каждый раз при обновлении страницы вы будете видеть два уведомления (ошибку и успех).</p><p>Далее, в начале файла <code>_layout.cshtml</code> добавьте строки:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>@using MyNotes.Services
@inject INotifyService NotifyService
</code></pre>">@using MyNotes.Services
@inject INotifyService NotifyService
</code></pre><p>Ключевое слово <code>inject</code> позволяет выполнить внедрение зависимости в коде razor.</p><p>Измените код отображения уведомлений:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>@if (NotifyService.HasError)
{
    &amp;lt;div class=&quot;alert error&quot;&amp;gt;
        &amp;lt;p&amp;gt;@NotifyService.ErrorMessage&amp;lt;/p&amp;gt;
        &amp;lt;span class=&quot;closebtn&quot; onclick=&quot;this.parentElement.style.display='none';&quot;&amp;gt;&amp;amp;times;&amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
}

@if (NotifyService.HasSuccess)
{
    &amp;lt;div class=&quot;alert success&quot;&amp;gt;
        &amp;lt;p&amp;gt;@NotifyService.SuccessMessage&amp;lt;/p&amp;gt;
        &amp;lt;span class=&quot;closebtn&quot; onclick=&quot;this.parentElement.style.display='none';&quot;&amp;gt;&amp;amp;times;&amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
}
</code></pre>">@if (NotifyService.HasError)
{
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"alert error"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>@NotifyService.ErrorMessage<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"closebtn"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"this.parentElement.style.display='none';"</span>&gt;</span>&amp;times;<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
}

@if (NotifyService.HasSuccess)
{
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"alert success"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>@NotifyService.SuccessMessage<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"closebtn"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"this.parentElement.style.display='none';"</span>&gt;</span>&amp;times;<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
}
</code></pre><p>Ниже (где-нибудь в конце файла) напишите следующий код:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>@{
    NotifyService.Clear();
}
</code></pre>">@{
    NotifyService.Clear();
}
</code></pre><p>Идея простая: мы показываем уведомления, если они есть и каждый раз их очищаем, чтобы они не появлялись повторно.</p><p>Выведем уведомления при добавлении записи. Сперва внедрим зависимость в модель страницы <code>AddPost</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private readonly IPostsService postsService;
private readonly INotifyService notifyService;

public AddPostViewModel AddPostViewModel { get; set; } = null!;

public AddPostModel(IPostsService postsService, INotifyService notifyService) 
{
    this.postsService = postsService;
    this.notifyService = notifyService;
}
</code></pre>"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPostsService postsService;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> INotifyService notifyService;

<span class="hljs-keyword">public</span> AddPostViewModel AddPostViewModel { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">null</span>!;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AddPostModel</span><span class="hljs-params">(IPostsService postsService, INotifyService notifyService)</span> 
</span>{
    <span class="hljs-keyword">this</span>.postsService = postsService;
    <span class="hljs-keyword">this</span>.notifyService = notifyService;
}
</code></pre><p>Далее, изменим код добавления записи (метод <code>OnPost</code> в <code>AddPost.cshtml</code>):</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>...
try
{
    postsService.AddPost(post);
    notifyService.Success(&quot;Запись успешно добавлена&quot;);
}
catch
{
    notifyService.Error(&quot;Произошла ошибка при добавлении записи&quot;);
    return Page();
}
return RedirectToPage(&quot;Index&quot;);
</code></pre>">...
<span class="hljs-keyword">try</span>
{
    postsService.AddPost(post);
    notifyService.Success(<span class="hljs-string">"Запись успешно добавлена"</span>);
}
<span class="hljs-keyword">catch</span>
{
    notifyService.Error(<span class="hljs-string">"Произошла ошибка при добавлении записи"</span>);
    <span class="hljs-keyword">return</span> Page();
}
<span class="hljs-keyword">return</span> RedirectToPage(<span class="hljs-string">"Index"</span>);
</code></pre><p>Запустите и проверьте работоспособность. Реализуйте вывод сообщений об обратной связи при других действиях пользователя (изменение и удаление, успешная регистрация).</p><h2 id="6-сохранение-работы"><a name="6-сохранение-работы" href="#6-сохранение-работы"></a>6 Сохранение работы</h2><p>Загрузите работу на gogs. При сохранении добейтесь того, чтобы  в репозитории каталог <code>/wwwroot/images/</code> не содержал изображений (был пустым).</p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
